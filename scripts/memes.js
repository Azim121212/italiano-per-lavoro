// –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–µ–º–æ–≤ –¥–ª—è –∑–∞–º–µ–Ω—ã —ç–º–æ–¥–∑–∏
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ–º-—à–∞–±–ª–æ–Ω—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
const memesLibrary = {
    // –ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Ñ–ª–∞–≥ / –ò—Ç–∞–ª–∏—è
    italy: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
    ],
    // –ì—Ä—É–ø–ø–∞ –ª—é–¥–µ–π
    people: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian
        'https://i.imgflip.com/1bh8.jpg', // Scumbag Steve
    ],
    // –ö–∞–ª–µ–Ω–¥–∞—Ä—å / –í—Ä–µ–º—è
    calendar: [
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –ß–∞—Å—ã / –í—Ä–µ–º—è
    time: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian
    ],
    // –ö–Ω–∏–≥–∏ / –û–±—É—á–µ–Ω–∏–µ
    books: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhk.jpg', // Y U No
    ],
    // –ü—Ä–æ–±–ª–µ–º–∞ / –ì—Ä—É—Å—Ç—å
    problem: [
        'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian
        'https://i.imgflip.com/1bh8.jpg', // Scumbag Steve
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
    ],
    // –†–µ—à–µ–Ω–∏–µ / –ò–¥–µ—è
    solution: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
    ],
    // –†–∞–±–æ—Ç–∞ / –ë–∏–∑–Ω–µ—Å
    work: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –û–±—É—á–µ–Ω–∏–µ / –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å
    teacher: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    location: [
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
    ],
    // –¢–µ–ª–µ—Ñ–æ–Ω / –ü–æ–¥–¥–µ—Ä–∂–∫–∞
    phone: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
    ],
    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã / –ü–æ–±–µ–¥–∞
    results: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
    ],
    // –†–∞–∑–≥–æ–≤–æ—Ä / –ü—Ä–∞–∫—Ç–∏–∫–∞
    practice: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –°—Ç—É–¥–µ–Ω—Ç
    student: [
        'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –ü–æ–∫—É–ø–∫–∏ / –ú–∞–≥–∞–∑–∏–Ω
    shopping: [
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
    ],
    // –¶–µ–ª—å / –§–æ–∫—É—Å
    target: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
    ],
    // –î–æ–∫—É–º–µ–Ω—Ç—ã / –ü–∏—Å—å–º–æ
    document: [
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
    ],
    // –¢–µ–∞—Ç—Ä / –†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã
    theater: [
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bij.jpg', // Success Kid
    ],
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ / –ü–æ–≤—Ç–æ—Ä
    refresh: [
        'https://i.imgflip.com/1bhk.jpg', // Y U No
        'https://i.imgflip.com/1bh5.jpg', // First World Problems
    ],
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default: [
        'https://i.imgflip.com/1bij.jpg', // Success Kid
        'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man
        'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian
    ]
};

// –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å)
const uniqueMemes = {
    'solution-image': 'https://i.imgflip.com/1bij.jpg', // Success Kid –¥–ª—è —Ä–µ—à–µ–Ω–∏—è
    'module-1': 'https://i.imgflip.com/1bhk.jpg', // Y U No –¥–ª—è –º–æ–¥—É–ª—è 1
    'module-2': 'https://i.imgflip.com/1bhw.jpg', // The Most Interesting Man –¥–ª—è –º–æ–¥—É–ª—è 2
    'module-3': 'https://i.imgflip.com/1bh9.jpg', // Bad Luck Brian –¥–ª—è –º–æ–¥—É–ª—è 3
    'benefit-1': 'https://i.imgflip.com/1bhw.jpg', // –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏
    'benefit-2': 'https://i.imgflip.com/1bhk.jpg', // –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
    'benefit-3': 'https://i.imgflip.com/1bh5.jpg', // –ì—Ä–∞—Ñ–∏–∫
    'benefit-4': 'https://i.imgflip.com/1bij.jpg', // –ü–æ–¥–¥–µ—Ä–∂–∫–∞
    'benefit-5': 'https://i.imgflip.com/1bh9.jpg', // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
    'benefit-6': 'https://i.imgflip.com/1bh8.jpg', // –ü—Ä–∞–∫—Ç–∏–∫–∞
    'feature-1': 'https://i.imgflip.com/1bij.jpg', // –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π
    'feature-2': 'https://i.imgflip.com/1bhw.jpg', // –ú–∏–Ω–∏-–≥—Ä—É–ø–ø—ã
    'feature-3': 'https://i.imgflip.com/1bhk.jpg', // –ü—Ä–∞–∫—Ç–∏–∫–∞
    'feature-4': 'https://i.imgflip.com/1bh5.jpg', // CV
    'feature-5': 'https://i.imgflip.com/1bh9.jpg', // –†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã
    'feature-6': 'https://i.imgflip.com/1bh8.jpg', // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
    'feature-7': 'https://i.imgflip.com/1bij.jpg', // –ü–æ–≤—Ç–æ—Ä
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –º–µ–º–∞ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function getRandomMeme(category = 'default') {
    const memes = memesLibrary[category] || memesLibrary.default;
    return memes[Math.floor(Math.random() * memes.length)];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –º–µ–º–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
function getUniqueMeme(elementId) {
    return uniqueMemes[elementId] || getRandomMeme();
}

// –ú–∞–ø–ø–∏–Ω–≥ —ç–º–æ–¥–∑–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –º–µ–º–æ–≤
const emojiToCategory = {
    'üáÆüáπ': 'italy',
    'üë•': 'people',
    'üìÖ': 'calendar',
    '‚è±Ô∏è': 'time',
    'üìö': 'books',
    'üòü': 'problem',
    'üí°': 'solution',
    'üíº': 'work',
    'üéì': 'teacher',
    'üìç': 'location',
    'üì±': 'phone',
    'üèÜ': 'results',
    'üó£Ô∏è': 'practice',
    'üë®‚Äçüéì': 'student',
    'üõí': 'shopping',
    'üéØ': 'target',
    'üìù': 'document',
    'üé≠': 'theater',
    'üîÑ': 'refresh',
    'üí¨': 'phone',
    '‚úàÔ∏è': 'default',
    '‚ú®': 'default',
    'üöÄ': 'default',
    'üí∞': 'default',
    '‚úì': 'default',
    '‚Üí': 'default'
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–º–µ–Ω—ã —ç–º–æ–¥–∑–∏ –Ω–∞ –º–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    let memeIndex = 0;
    const usedMemes = new Set();
    
    // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —ç–º–æ–¥–∑–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–º–æ–≤
    const emojiElements = document.querySelectorAll('[class*="icon"], .logo-icon, .stat-icon, .module-icon, .benefit-icon, .testimonial-avatar, .image-icon, .nav-logo-icon, .feature-icon');
    
    emojiElements.forEach((element, index) => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ–∫—Ü–∏—é "–ù–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ" - –æ—Å—Ç–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–µ —Å–º–∞–π–ª–∏–∫–∏
        if (element.closest('.solution-section')) {
            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –±—ã–ª –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –º–µ–º, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–º–æ–¥–∑–∏
            if (element.classList.contains('meme-container')) {
                const originalEmoji = element.dataset.originalEmoji || 'üí°';
                element.innerHTML = originalEmoji;
                element.classList.remove('meme-container');
                element.style.width = '';
                element.style.height = '';
                element.style.minWidth = '';
                element.style.minHeight = '';
            }
            return; // –ù–µ –∑–∞–º–µ–Ω—è–µ–º —ç–º–æ–¥–∑–∏ –Ω–∞ –º–µ–º—ã –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏
        }
        
        const text = element.textContent || element.innerHTML;
        const emoji = text.trim();
        
        if (emoji && emojiToCategory[emoji]) {
            const category = emojiToCategory[emoji];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
            let elementId = '';
            if (element.closest('.module-card')) {
                const moduleCard = element.closest('.module-card');
                const moduleNumber = moduleCard.querySelector('.module-number')?.textContent;
                if (moduleNumber?.includes('1')) elementId = 'module-1';
                else if (moduleNumber?.includes('2')) elementId = 'module-2';
                else if (moduleNumber?.includes('3')) elementId = 'module-3';
            } else if (element.closest('.benefit-card')) {
                const benefitCards = Array.from(document.querySelectorAll('.benefit-card'));
                const cardIndex = benefitCards.indexOf(element.closest('.benefit-card'));
                elementId = `benefit-${cardIndex + 1}`;
            } else if (element.closest('.pricing-features')) {
                const featureItems = Array.from(document.querySelectorAll('.pricing-features li'));
                const itemIndex = featureItems.indexOf(element.closest('li'));
                elementId = `feature-${itemIndex + 1}`;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –º–µ–º
            let memeUrl;
            if (elementId && uniqueMemes[elementId]) {
                memeUrl = uniqueMemes[elementId];
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–Ω—ã–µ –º–µ–º—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∏–∑–±–µ–≥–∞—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
                const memes = memesLibrary[category] || memesLibrary.default;
                const availableMemes = memes.filter(m => !usedMemes.has(m));
                if (availableMemes.length === 0) {
                    // –ï—Å–ª–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    usedMemes.clear();
                    memeUrl = memes[0];
                } else {
                    memeUrl = availableMemes[memeIndex % availableMemes.length];
                }
                usedMemes.add(memeUrl);
                memeIndex++;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–º–∞
            const img = document.createElement('img');
            img.src = memeUrl;
            img.alt = emoji;
            img.className = 'meme-image';
            img.loading = 'lazy';
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            img.onerror = function() {
                // Fallback –Ω–∞ —ç–º–æ–¥–∑–∏, –µ—Å–ª–∏ –º–µ–º –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
                element.innerHTML = emoji;
                element.classList.remove('meme-container');
                element.style.width = '';
                element.style.height = '';
                element.style.minWidth = '';
                element.style.minHeight = '';
            };
            
            // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            element.innerHTML = '';
            element.appendChild(img);
            element.classList.add('meme-container');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è fallback
            if (!element.dataset.originalEmoji) {
                element.dataset.originalEmoji = emoji;
            }
        }
    });
    
    // –¢–∞–∫–∂–µ –∑–∞–º–µ–Ω—è–µ–º —ç–º–æ–¥–∑–∏ –≤ —Ç–µ–∫—Å—Ç–µ –∫–Ω–æ–ø–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö (—Ç–æ–ª—å–∫–æ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–Ω–ª–∞–π–Ω)
    const textElements = document.querySelectorAll('.btn, .section-text, .module-description');
    textElements.forEach(element => {
        let html = element.innerHTML;
        Object.keys(emojiToCategory).forEach(emoji => {
            if (html.includes(emoji)) {
                const category = emojiToCategory[emoji];
                const memeUrl = getRandomMeme(category);
                // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–ª–∞–π–Ω-–º–µ–º
                html = html.replace(emoji, `<img src="${memeUrl}" alt="${emoji}" class="inline-meme" style="width: 24px; height: 24px; vertical-align: middle; border-radius: 4px; margin: 0 4px;">`);
            }
        });
        element.innerHTML = html;
    });
});

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
window.memesLibrary = memesLibrary;
window.getRandomMeme = getRandomMeme;
window.getUniqueMeme = getUniqueMeme;
